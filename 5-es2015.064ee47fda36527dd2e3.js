(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"+Z7H":function(t){t.exports=JSON.parse('[{"constant":true,"inputs":[],"name":"ETH_ADDRESS","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"FLAG_BANCOR","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"FLAG_COMPOUND","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"FLAG_FULCRUM","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"FLAG_KYBER","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"FLAG_OASIS","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"FLAG_UNISWAP","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"contract IKyberNetworkContract","name":"kyberNetworkContract","type":"address"},{"internalType":"contract IERC20","name":"fromToken","type":"address"},{"internalType":"contract IERC20","name":"toToken","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"_calculateKyberReturnWithEth","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"contract IERC20","name":"token","type":"address"}],"name":"_isFulcrumToken","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"bancorContractRegistry","outputs":[{"internalType":"contract IBancorContractRegistry","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"cETH","outputs":[{"internalType":"contract ICompoundEther","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"contract IERC20","name":"fromToken","type":"address"},{"internalType":"contract IERC20","name":"toToken","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"calculateBancorReturn","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"contract IERC20","name":"fromToken","type":"address"},{"internalType":"contract IERC20","name":"toToken","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"calculateKyberReturn","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"contract IERC20","name":"fromToken","type":"address"},{"internalType":"contract IERC20","name":"toToken","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"calculateOasisReturn","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"contract IERC20","name":"fromToken","type":"address"},{"internalType":"contract IERC20","name":"toToken","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"calculateUniswapReturn","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"compound","outputs":[{"internalType":"contract ICompound","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"contract IERC20","name":"fromToken","type":"address"},{"internalType":"contract IERC20","name":"toToken","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"parts","type":"uint256"},{"internalType":"uint256","name":"disableFlags","type":"uint256"}],"name":"getAllRatesForDEX","outputs":[{"internalType":"uint256[]","name":"results","type":"uint256[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"contract IERC20","name":"fromToken","type":"address"},{"internalType":"contract IERC20","name":"toToken","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"parts","type":"uint256"},{"internalType":"uint256","name":"disableFlags","type":"uint256"}],"name":"getExpectedReturn","outputs":[{"internalType":"uint256","name":"returnAmount","type":"uint256"},{"internalType":"uint256[]","name":"distribution","type":"uint256[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"contract IERC20","name":"fromToken","type":"address"},{"internalType":"contract IERC20","name":"toToken","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"minReturn","type":"uint256"},{"internalType":"uint256","name":"parts","type":"uint256"},{"internalType":"uint256","name":"disableFlags","type":"uint256"}],"name":"goodSwap","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[],"name":"kyberNetworkProxy","outputs":[{"internalType":"contract IKyberNetworkProxy","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"log","outputs":[],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"oasisExchange","outputs":[{"internalType":"contract IOasisExchange","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"contract IERC20","name":"fromToken","type":"address"},{"internalType":"contract IERC20","name":"toToken","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"minReturn","type":"uint256"},{"internalType":"uint256[]","name":"distribution","type":"uint256[]"},{"internalType":"uint256","name":"disableFlags","type":"uint256"}],"name":"swap","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[],"name":"uniswapFactory","outputs":[{"internalType":"contract IUniswapFactory","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"}]')},hup1:function(t,e,n){"use strict";n.r(e);var o=n("ofXK"),i=n("tyNb"),s=n("fXoL");let a=(()=>{class t{constructor(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Ib({type:t,selectors:[["app-leverage"]],decls:1,vars:0,template:function(t,e){1&t&&s.Pb(0,"router-outlet")},directives:[i.f],styles:[""]}),t})();var r=n("mrSG"),c=n("3Pt+"),l=n("nkFk"),u=n("pdS3"),b=n("5+qj"),d=n("L3Cm"),p=n("wHSu"),h=n("JX91"),m=n("lJxs"),g=n("+Z7H");let y=(()=>{class t{constructor(t,e){this.configurationService=t,this.web3Service=e,this.init()}init(){return Object(r.a)(this,void 0,void 0,(function*(){this.contract=new((yield this.web3Service.getWeb3Provider()).eth.Contract)(g,this.configurationService.ONE_SPLIT_CONTRACT_ADDRESS)}))}calculateZrxOrderFees(t){return Object(r.a)(this,void 0,void 0,(function*(){return this.userGasPrice.mul(15e4).mul(t)}))}getContract(){return Object(r.a)(this,void 0,void 0,(function*(){return new Promise((t,e)=>{setTimeout(e,3e5);const n=()=>{this.contract?t(this.contract):setTimeout(()=>{n()},100)};n()})}))}getExpectedReturn(t,e,n,o,i){return Object(r.a)(this,void 0,void 0,(function*(){return(yield this.getContract()).methods.getExpectedReturn(t,e,n,o,i).call()}))}getAllRatesForDEX(t,e,n,o,i){return Object(r.a)(this,void 0,void 0,(function*(){return(yield this.getContract()).methods.getAllRatesForDEX(t,e,n,o,i).call()}))}encodeSwap(t,e,n,o,i,s){return this.getSwapMethod(t,e,n,o,i,s).encodeABI()}getSwapMethod(t,e,n,o,i,s){return this.contract.methods.swap(t,e,n,o,i,s)}}return t.\u0275fac=function(e){return new(e||t)(s.bc(l.a),s.bc(u.a))},t.\u0275prov=s.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var k=n("tk/3");let f=(()=>{class t{constructor(t,e,n,o,i){this.tokenService=t,this.web3Service=e,this.configurationService=n,this.oneSplitService=o,this.http=i,this.tickers=[],this.priceEndpoint=this.configurationService.CORS_PROXY_URL+"https://api.coinpaprika.com/v1/",setInterval(()=>{try{this.setEthPrice(),this.updateTickers()}catch(t){}},3e4),this.setEthPrice(),this.updateTickers()}updateTickers(){return Object(r.a)(this,void 0,void 0,(function*(){try{this.tickers=(yield this.http.get(this.priceEndpoint+"tickers").toPromise()).filter(t=>-1===t.id.indexOf("knc-kingn-coin"))}catch(t){}}))}setEthPrice(){return Object(r.a)(this,void 0,void 0,(function*(){this.ethPrice=yield this.fetchTokenPrice("ETH"),this.formatedEthPrice=this.tokenService.formatAsset("ETH",this.ethPrice)}))}getEthPrice(){return Object(r.a)(this,void 0,void 0,(function*(){return new Promise((t,e)=>{setTimeout(e,3e5);const n=()=>{this.ethPrice?t(this.ethPrice):setTimeout(()=>{n()},100)};n()})}))}fetchTokenPrice(t){return Object(r.a)(this,void 0,void 0,(function*(){if("DAI"===t||"SAI"===t)return b.ethers.utils.bigNumberify(1e8).mul(1e8);const{returnAmount:e}=yield this.oneSplitService.getExpectedReturn(this.tokenService.getTokenBySymbol("DAI").address,this.tokenService.getTokenBySymbol(t).address,b.ethers.utils.bigNumberify(10).pow(16),b.ethers.utils.bigNumberify(20),b.ethers.utils.bigNumberify(0));return e}))}getTickers(){return Object(r.a)(this,void 0,void 0,(function*(){return new Promise((t,e)=>{setTimeout(e,3e5);const n=()=>{this.tickers.length?t(this.tickers):setTimeout(()=>{n()},100)};n()})}))}getUSDPrice(t){return Object(r.a)(this,void 0,void 0,(function*(){return t=t.map(t=>t.toLowerCase()),(yield this.getTickers()).filter(e=>-1!==t.indexOf(e.symbol.toLowerCase())).map(t=>{const e={};return e[t.symbol]=t.quotes.USD.price,e})}))}getRateToEther(t){return Object(r.a)(this,void 0,void 0,(function*(){let e;if("ETH"===t||"WETH"===t)e=b.ethers.utils.bigNumberify(10).pow(14);else{const{returnAmount:n}=yield this.oneSplitService.getExpectedReturn(this.configurationService.ETH_ADDRESS,this.tokenService.getTokenBySymbol(t).address,b.ethers.utils.bigNumberify(10).pow(14),b.ethers.utils.bigNumberify(1),b.ethers.utils.bigNumberify(0));e=n.gt(0)?n:b.ethers.utils.bigNumberify(1)}return e}))}calculateToEther(t,e,n,o){return Object(r.a)(this,void 0,void 0,(function*(){try{const i=yield this.getRateToEther(t);return e.map((t,e)=>t.map((t,s)=>{if(!s)return b.ethers.utils.bigNumberify(0);let a=b.ethers.utils.bigNumberify(0);return n[e]&&n[e][s]&&(a=n[e][s]),t.mul(b.ethers.utils.bigNumberify(10).pow(14)).div(i).sub(a.mul(o))}))}catch(i){console.error(i)}return b.ethers.utils.bigNumberify(0)}))}}return t.\u0275fac=function(e){return new(e||t)(s.bc(d.a),s.bc(u.a),s.bc(l.a),s.bc(y),s.bc(k.a))},t.\u0275prov=s.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var T=n("1kSV");const v=["tokenDropDown"];function S(t,e){if(1&t&&(s.Tb(0,"span"),s.Ic(1),s.Pb(2,"br"),s.Sb()),2&t){const t=s.ic(2).$implicit;s.Bb(1),s.Kc(" ",t.formatedUSD,"")}}function w(t,e){if(1&t&&(s.Tb(0,"span",15),s.Gc(1,S,3,1,"span",16),s.Ic(2),s.Sb()),2&t){const t=s.ic().$implicit;s.Bb(1),s.nc("ngIf",t.formatedUSD),s.Bb(1),s.Kc(" ",t.formatedTokenBalance," ")}}function B(t,e){if(1&t){const t=s.Ub();s.Tb(0,"li",13),s.fc("click",(function(n){s.zc(t);const o=e.$implicit;return s.ic(2).setToken(o)})),s.Pb(1,"img",4),s.Ic(2),s.Pb(3,"br"),s.Gc(4,w,3,2,"span",14),s.Sb()}if(2&t){const t=e.$implicit;s.Bb(1),s.nc("src","assets/tokens/"+t.address.toLowerCase()+".png",s.Bc),s.Bb(1),s.Kc(" ",t.symbol," "),s.Bb(2),s.nc("ngIf",t.formatedTokenBalance>0)}}function I(t,e){if(1&t&&(s.Tb(0,"div",1,2),s.Tb(2,"button",3),s.Tb(3,"span"),s.Pb(4,"img",4),s.Ic(5),s.Sb(),s.Sb(),s.Tb(6,"div",5),s.Tb(7,"div",6),s.Pb(8,"input",7,8),s.Sb(),s.Tb(10,"div",9),s.Tb(11,"div",10),s.Tb(12,"ul",11),s.Gc(13,B,5,3,"li",12),s.jc(14,"async"),s.Sb(),s.Sb(),s.Sb(),s.Sb(),s.Sb()),2&t){const t=s.ic();s.Bb(4),s.nc("src","assets/tokens/"+t.tokens[t.token].address.toLowerCase()+".png",s.Bc),s.Bb(1),s.Kc(" ",t.token," "),s.Bb(3),s.nc("formControl",t.tokenSearchControl),s.Bb(5),s.nc("ngForOf",s.kc(14,4,t.tokenSearchResults))}}let C=(()=>{class t{constructor(t,e,n,o){this.tokenService=t,this.configurationService=e,this.web3Service=n,this.tokenPriceService=o,this.tokenSearchControl=new c.c(""),this.tokenAmountBN=b.ethers.utils.bigNumberify(0),this.tokenBalanceBN=b.ethers.utils.bigNumberify(0),this.maxTokenBalanceBN=b.ethers.utils.bigNumberify(0),this.usdFormatter=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),this.tokenBlackList=[],this.tokens=[],this.balancesOfTokens=[],this.pricesOfTokens=[],this.approved=!1,this.loading=!1,this.tokenDropDownOpened=!1,this.onTokenSelectEmitter=new s.n}ngOnInit(){return Object(r.a)(this,void 0,void 0,(function*(){this.tokens=Object.assign({},yield this.tokenService.getTokens()),this.tokenBlackList.forEach(t=>delete this.tokens[t]),this.initTokenSearchResults(),this.web3Service.connectEvent.subscribe(()=>{this.loadBalancesOfTokens()}),this.web3Service.disconnectEvent.subscribe(()=>{this.clearTokenBalances()}),this.runBackgroundJobs()}))}clearTokenBalances(){const t=Object.values(this.tokens);for(let e=0;e<t.length;e++)this.tokens[t[e].symbol].balance=0}initTokenSearchResults(){return Object(r.a)(this,void 0,void 0,(function*(){this.tokenSearchResults=this.tokenSearchControl.valueChanges.pipe(Object(h.a)(""),Object(m.a)(t=>{let e=Object.values(this.tokens);return""!==t?e.filter(e=>e.symbol.toLowerCase().indexOf(t.toLowerCase())>-1).slice(0,10).map(t=>this.addBalancesToSearchResults(t)).sort((e,n)=>this.sortSearchResults(t,e,n)):(e=e.map(t=>this.addBalancesToSearchResults(t)).sort((e,n)=>this.sortSearchResults(t,e,n)),e)}))}))}addBalancesToSearchResults(t){if(t.balance)try{t.formatedTokenBalance=this.tokenService.toFixed(this.tokenService.formatAsset(t.symbol,t.balance),18)}catch(e){console.log("token",t),console.error(e)}return t}setToken(t){this.token=t.symbol,this.tokenDropDown.close(),this.onTokenSelectEmitter.emit(t)}sortSearchResults(t,e,n){return e.usd||(e.usd=0),n.usd||(n.usd=0),e.balance||(e.balance=b.ethers.utils.bigNumberify(0)),n.balance||(n.balance=b.ethers.utils.bigNumberify(0)),e.symbol.toLowerCase()===t.toLowerCase()?-1:e.usd>n.usd?-1:e.usd<n.usd?1:0}runBackgroundJobs(){return Object(r.a)(this,void 0,void 0,(function*(){const t=(new Date).getTime();try{const t=[];this.web3Service.walletAddress&&t.push(this.loadBalancesOfTokens()),this.checkAllowance(),yield Promise.all(t)}catch(e){console.error(e)}try{(new Date).getTime()-t>1e4?this.runBackgroundJobs():setTimeout(()=>{this.runBackgroundJobs()},1e4-((new Date).getTime()-t))}catch(e){console.error(e)}}))}checkAllowance(){return Object(r.a)(this,void 0,void 0,(function*(){this.approved="ETH"===this.token||!!this.web3Service.walletAddress&&(yield this.tokenService.isApproved(this.token,this.tokenSpender,this.tokenAmountBN))}))}loadBalancesOfTokens(){return Object(r.a)(this,void 0,void 0,(function*(){try{if(this.web3Service.walletAddress){const t=Object.values(this.tokens),{balances:e,prices:n}=yield this.tokenService.getTokenBalancesAndPricesForTokens(this.web3Service.walletAddress,t);this.balancesOfTokens=e,this.pricesOfTokens=n;for(let o=0;o<this.balancesOfTokens.length;o++)this.tokens[t[o].symbol]?(this.tokens[t[o].symbol].balance=this.balancesOfTokens[o],this.pricesOfTokens[o].gt(0)&&"ETH"!==t[o].symbol?(this.tokens[t[o].symbol].price=this.balancesOfTokens[o].mul(1e9).div(this.pricesOfTokens[o]),this.tokens[t[o].symbol].usd=this.tokens[t[o].symbol].price.toNumber()/100/1e9,this.tokens[t[o].symbol].formatedUSD=this.usdFormatter.format(this.tokens[t[o].symbol].usd)):(this.tokens[t[o].symbol].usd=0,this.tokens[t[o].symbol].formatedUSD=0)):console.log(t[o].symbol);this.tokens.ETH&&(this.tokens.ETH.balance=yield this.web3Service.web3Provider.eth.getBalance(this.web3Service.walletAddress),this.tokens.ETH.usd=b.ethers.utils.bigNumberify(this.tokens.ETH.balance).mul(1e9).div(yield this.tokenPriceService.getEthPrice()).toNumber()/100/1e9,this.tokens.ETH.formatedUSD=this.usdFormatter.format(this.tokens.ETH.usd))}}catch(t){console.error(t)}this.tokenDropDownOpened||this.tokenSearchControl.setValue(this.tokenSearchControl.value)}))}}return t.\u0275fac=function(e){return new(e||t)(s.Ob(d.a),s.Ob(l.a),s.Ob(u.a),s.Ob(f))},t.\u0275cmp=s.Ib({type:t,selectors:[["oi-token-selector"]],viewQuery:function(t,e){var n;1&t&&s.Mc(v,!0),2&t&&s.wc(n=s.gc())&&(e.tokenDropDown=n.first)},inputs:{tokenAmountBN:"tokenAmountBN",tokenBlackList:"tokenBlackList",token:"token",tokenSpender:"tokenSpender"},outputs:{token:"token",onTokenSelectEmitter:"onTokenSelect"},decls:1,vars:1,consts:[["ngbDropdown","",4,"ngIf"],["ngbDropdown",""],["tokenDropDown","ngbDropdown"],["ngbDropdownToggle","","type","button",1,"btn","btn-block","btn-outline-secondary","text-left","is-flex","token-dropdown"],["onerror","this.src = 'assets/tokens/token.png';",1,"mr-1",3,"src"],["aria-labelledby","tokenDropdown","ngbDropdownMenu",""],[1,"p-2","border-bottom"],["autocomplete","off","placeholder",'Try "DAI"',"type","search",1,"form-control","border-0","tokenSearch",3,"formControl"],["tokenSearchField",""],[1,"tokenScrollArea"],[1,"p-2"],[1,"list-group","list-group-flush"],["class","list-group-item",3,"click",4,"ngFor","ngForOf"],[1,"list-group-item",3,"click"],["class","text-secondary",4,"ngIf"],[1,"text-secondary"],[4,"ngIf"]],template:function(t,e){1&t&&s.Gc(0,I,15,6,"div",0),2&t&&s.nc("ngIf",e.tokens[e.token])},directives:[o.l,T.c,T.f,T.d,c.b,c.j,c.d,o.k],pipes:[o.b],styles:["button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}li[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:16px}.token-dropdown[_ngcontent-%COMP%]:active, .token-dropdown[_ngcontent-%COMP%]:focus, .token-dropdown[_ngcontent-%COMP%]:hover{color:#212529;background:transparent;box-shadow:none}.btn-outline-secondary[_ngcontent-%COMP%]:not(:disabled):not(.disabled).active, .btn-outline-secondary[_ngcontent-%COMP%]:not(:disabled):not(.disabled):active, .show[_ngcontent-%COMP%] > .btn-outline-secondary.dropdown-toggle[_ngcontent-%COMP%]{background:transparent}.dropdown-toggle[_ngcontent-%COMP%]:after{color:#212529}.tokenSearch[_ngcontent-%COMP%]:focus{box-shadow:none}.tokenScrollArea[_ngcontent-%COMP%]{max-height:20rem;overflow:auto;min-width:15rem}.is-flex[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.list-group-item[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),t})();var M=n("Kj3r"),P=n("/uUt");function O(t,e){if(1&t&&(s.Tb(0,"span"),s.Ic(1),s.Sb()),2&t){const t=s.ic();s.Bb(1),s.Kc("\u2248 ",t.tokenUsdCostView,"")}}function N(t,e){1&t&&(s.Tb(0,"span"),s.Ic(1,"\xa0"),s.Sb())}let A=(()=>{class t{constructor(t,e,n){this.tokenService=t,this.tokenPriceService=e,this.web3Service=n,this.tokenAmountControl=new c.c(""),this.maxTokenBalance="0.0",this.tokenAmountBNChange=new s.n,this.tokenBalance="0.0",this.tokenBalanceBN=b.ethers.utils.bigNumberify(0),this.tokenUsdCostView="",this.usdFormatter=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),this._tokenAmountBN=b.ethers.utils.bigNumberify(0)}get token(){return this._token}set token(t){this._token=t,this.reset(),this.runBackgroundJobs()}get tokenAmountBN(){return this._tokenAmountBN}set tokenAmountBN(t){this._tokenAmountBN=t,this.tokenAmountControl.setValue(this.tokenService.formatAsset(this.token,t))}ngOnInit(){return Object(r.a)(this,void 0,void 0,(function*(){this.tokenAmountControl.valueChanges.pipe(Object(M.a)(200),Object(P.a)()).subscribe(t=>{if(""!==t&&this.isNumeric(t)&&0!==t&&!t.match(/^([0\.]+)$/)){this.tokenAmount=t;const e=this.tokenService.parseAsset(this.token,t);e.eq(this._tokenAmountBN)||(this._tokenAmountBN=e,this.tokenAmountBNChange.emit(this._tokenAmountBN)),this.updateTokenUSDCosts()}}),this.web3Service.connectEvent.subscribe(()=>{this.loadTokenBalance()}),this.web3Service.disconnectEvent.subscribe(()=>{this.reset()}),setTimeout(()=>{this.runBackgroundJobs()},5e3)}))}reset(){this.maxTokenBalance="0.0",this.tokenBalance="0.0",this.tokenBalanceBN=b.ethers.utils.bigNumberify(0),this.tokenUsdCost=b.ethers.utils.bigNumberify(0),this.tokenUsdCostView=""}isNumeric(t){return/^\d*\.{0,1}\d*$/.test(t)}loadTokenBalance(){return Object(r.a)(this,void 0,void 0,(function*(){this.web3Service.walletAddress&&("ETH"===this.token?(this.tokenBalanceBN=b.ethers.utils.bigNumberify(yield this.web3Service.web3Provider.eth.getBalance(this.web3Service.walletAddress)).sub(this.gasPrice.mul(5e6)),this.tokenBalanceBN.lte(0)&&(this.tokenBalanceBN=b.ethers.utils.bigNumberify(yield this.web3Service.web3Provider.eth.getBalance(this.web3Service.walletAddress))),this.tokenBalance=b.ethers.utils.formatEther(this.tokenBalanceBN)):(this.tokenBalanceBN=yield this.tokenService.getTokenBalance(this.token,yield this.web3Service.walletAddress),this.tokenBalance=this.tokenService.formatAsset(this.token,this.tokenBalanceBN)),this.tokenBalance=this.tokenService.toFixed(this.tokenBalance,18),"0"===this.tokenBalance&&(this.tokenBalance="0.0",this.tokenBalanceBN=b.ethers.utils.bigNumberify(0)),this.maxTokenBalance=this.tokenService.toFixed(this.tokenBalance,12))}))}setTokenAmount(){return Object(r.a)(this,void 0,void 0,(function*(){this.tokenAmountControl.setValue(this.tokenBalance)}))}updateTokenUSDCosts(){return Object(r.a)(this,void 0,void 0,(function*(){try{this.tokenUsdPrice||(this.tokenUsdPrice=yield this.tokenPriceService.fetchTokenPrice(this.token)),this.tokenUsdPrice.gt(0)&&(this.tokenUsdCost=this.tokenAmountBN.div(this.tokenUsdPrice),this.tokenUsdCostView=this.usdFormatter.format(this.tokenUsdCost.toString()/100))}catch(t){console.error(t)}}))}loadUSDPrice(){return Object(r.a)(this,void 0,void 0,(function*(){try{this.tokenUsdPrice=yield this.tokenPriceService.fetchTokenPrice(this.token),this.updateTokenUSDCosts()}catch(t){}}))}runBackgroundJobs(){return Object(r.a)(this,void 0,void 0,(function*(){const t=(new Date).getTime();try{const t=[];t.push(this.loadUSDPrice()),t.push(this.loadTokenBalance()),yield Promise.all(t)}catch(e){console.error(e)}try{(new Date).getTime()-t>1e4?this.runBackgroundJobs():setTimeout(()=>{this.runBackgroundJobs()},1e4-((new Date).getTime()-t))}catch(e){console.error(e)}}))}}return t.\u0275fac=function(e){return new(e||t)(s.Ob(d.a),s.Ob(f),s.Ob(u.a))},t.\u0275cmp=s.Ib({type:t,selectors:[["oi-token-amount-field"]],inputs:{name:"name",id:"id",gasPrice:"gasPrice",token:"token",tokenAmountBN:"tokenAmountBN"},outputs:{tokenAmountBNChange:"tokenAmountBNChange"},decls:6,vars:6,consts:[[1,"form-text","text-muted","text-left","position-relative","mb-1","tokenBalance",2,"margin-top","-23px","white-space","nowrap","overflow","hidden","text-overflow","ellipsis",3,"click"],["aria-describedby","tokenBalance","autocomplete","off","numeric","","numericType","decimal","pattern","[0-9\\.]*","type","text",1,"form-control","text-right",3,"formControl","id","name"],["id","tokenCost",1,"form-text","text-right","text-info"],[4,"ngIf"]],template:function(t,e){1&t&&(s.Tb(0,"small",0),s.fc("click",(function(t){return e.setTokenAmount()})),s.Ic(1),s.Sb(),s.Pb(2,"input",1),s.Tb(3,"small",2),s.Gc(4,O,2,1,"span",3),s.Gc(5,N,2,0,"span",3),s.Sb()),2&t&&(s.Bb(1),s.Kc(" Max: ",e.maxTokenBalance,"\n"),s.Bb(1),s.nc("formControl",e.tokenAmountControl)("id",e.id)("name",e.name),s.Bb(2),s.nc("ngIf",e.tokenUsdCost),s.Bb(1),s.nc("ngIf",!e.tokenUsdCost))},directives:[c.b,c.m,c.j,c.d,o.l],styles:[".tokenBalance[_ngcontent-%COMP%]{cursor:pointer}"]}),t})();var x=n("oW1M"),E=n("SND4"),R=n("6NWb");function _(t,e){1&t&&s.Pb(0,"app-loading-spinner")}function D(t,e){if(1&t){const t=s.Ub();s.Tb(0,"ngb-alert",34),s.fc("close",(function(e){return s.zc(t),s.ic(3).done=!1})),s.Ic(1," Swap transaction was successfully sent."),s.Pb(2,"br"),s.Tb(3,"a",35),s.Ic(4),s.Sb(),s.Sb()}if(2&t){const t=s.ic(3);s.Bb(3),s.nc("href","https://etherscan.io/tx/"+t.transactionHash,s.Bc),s.Bb(1),s.Jc(t.transactionHash)}}function L(t,e){if(1&t){const t=s.Ub();s.Tb(0,"ngb-alert",36),s.fc("close",(function(e){return s.zc(t),s.ic(3).error=!1})),s.Ic(1," An error is occured. Please try again or contact us. If you are using Metamask, you can try to switch from mainnet to testnet and back to solve this problem. "),s.Sb()}}function j(t,e){if(1&t&&(s.Tb(0,"div",31),s.Gc(1,D,5,2,"ngb-alert",32),s.Gc(2,L,2,0,"ngb-alert",33),s.Sb()),2&t){const t=s.ic(2);s.Bb(1),s.nc("ngIf",t.done),s.Bb(1),s.nc("ngIf",t.error)}}function U(t,e){if(1&t&&(s.Tb(0,"div"),s.Gc(1,j,3,2,"div",30),s.Sb()),2&t){const t=s.ic();s.Bb(1),s.nc("ngIf",t.done||t.error)}}function F(t,e){if(1&t&&(s.Tb(0,"div"),s.Tb(1,"div",37),s.Tb(2,"div",38),s.Ic(3,"Stop loss at "),s.Pb(4,"fa-icon",39),s.Sb(),s.Tb(5,"div",40),s.Tb(6,"div",41),s.Pb(7,"input",42),s.Tb(8,"div",43),s.Tb(9,"button",44),s.Ic(10,"MAX"),s.Sb(),s.Sb(),s.Sb(),s.Sb(),s.Sb(),s.Tb(11,"div",37),s.Tb(12,"div",38),s.Ic(13,"Take profit at "),s.Pb(14,"fa-icon",45),s.Sb(),s.Tb(15,"div",40),s.Tb(16,"div",41),s.Pb(17,"input",42),s.Tb(18,"div",43),s.Tb(19,"button",44),s.Ic(20,"MAX"),s.Sb(),s.Sb(),s.Sb(),s.Sb(),s.Sb(),s.Sb()),2&t){const t=s.ic();s.Bb(4),s.nc("icon",t.info),s.Bb(10),s.nc("icon",t.info)}}function H(t,e){if(1&t){const t=s.Ub();s.Tb(0,"tr"),s.Tb(1,"td"),s.Ic(2),s.Sb(),s.Tb(3,"td"),s.Ic(4),s.Sb(),s.Tb(5,"td"),s.Ic(6),s.Sb(),s.Tb(7,"td"),s.Ic(8),s.Sb(),s.Tb(9,"td"),s.Ic(10),s.Sb(),s.Tb(11,"td"),s.Ic(12),s.Sb(),s.Tb(13,"td"),s.Ic(14),s.Sb(),s.Tb(15,"td"),s.Tb(16,"button",9),s.fc("click",(function(n){s.zc(t);const o=e.$implicit;return s.ic().operate(o)})),s.Ic(17," chart "),s.Sb(),s.Tb(18,"button",10),s.fc("click",(function(n){s.zc(t);const o=e.$implicit;return s.ic().operate(o)})),s.Ic(19," liquidate "),s.Sb(),s.Sb(),s.Sb()}if(2&t){const t=e.$implicit;s.Bb(2),s.Jc(t.tokenName),s.Bb(2),s.Jc(t.positionModel),s.Bb(2),s.Jc(t.leverageModel),s.Bb(2),s.Jc(t.profit),s.Bb(2),s.Jc(t.status),s.Bb(2),s.Jc(t.stopLoss),s.Bb(2),s.Jc(t.stopWin)}}const G=[{tokenName:"ETH",profit:"130%",status:"healthy",stopLoss:"210$",stopWin:"290$",positionModel:"short",leverageModel:"2x"},{tokenName:"MKR",profit:"90%",status:"healthy",stopLoss:"1110$",stopWin:"2920$",positionModel:"long",leverageModel:"5x"},{tokenName:"WBTC",profit:"1330%",status:"healthy",stopLoss:"9110$",stopWin:"14000$",positionModel:"long",leverageModel:"3x"}],J=[{path:"",component:a,children:[{path:"",component:(()=>{class t{constructor(t,e,n){this.configurationService=t,this.tokenService=e,this.web3Service=n,this.formGroup=new c.e({}),this.marked=!1,this._useT800SaveBot="1"===localStorage.getItem("leverageUseT800SaveBot")||!localStorage.getItem("leverageUseT800SaveBot"),this.tokenSpender="0x0000000000000000000000000000000000000000",this.marginToken=localStorage.getItem("leverageMarginToken")?localStorage.getItem("leverageMarginToken"):"ETH",this.payToken=localStorage.getItem("leveragePayToken")?localStorage.getItem("leveragePayToken"):"DAI",this.info=p.c,this.tokenBlackList=[],this.marginTokenList=["ETH","DAI","WBTC","ZRX","MKR"],this._amountBN=localStorage.getItem("leverageAmountBN")?b.ethers.utils.bigNumberify(localStorage.getItem("leverageAmountBN")):b.ethers.utils.bigNumberify(1e9).mul(1e9).mul(1e3),this._positionModel=localStorage.getItem("leveragePositionModel")?localStorage.getItem("leveragePositionModel"):"long",this._leverageModel=localStorage.getItem("leverageLeverageModel")?localStorage.getItem("leverageLeverageModel"):"3x",this.loading=!0,this.transactionHash="",this.error=!1,this.done=!1}get useT800SaveBot(){return this._useT800SaveBot}set useT800SaveBot(t){this._useT800SaveBot=t,localStorage.setItem("leverageUseT800SaveBot",t?"1":"0")}get amountBN(){return this._amountBN}set amountBN(t){this._amountBN=t,localStorage.setItem("leverageAmountBN",this._amountBN.toString())}get positionModel(){return this._positionModel}set positionModel(t){this._positionModel=t,localStorage.setItem("leveragePositionModel",t)}get leverageModel(){return this._leverageModel}set leverageModel(t){this._leverageModel=t,localStorage.setItem("leverageLeverageModel",t)}ngOnInit(){this.tokenBlackList=Object.keys(this.tokenService.tokens).filter(t=>-1===this.marginTokenList.indexOf(t)),this.gasPrice=this.configurationService.fastGasPrice,this.loading=!1}onMarginTokenSelect(t){return Object(r.a)(this,void 0,void 0,(function*(){this.marginToken=t.symbol,localStorage.setItem("leverageMarginToken",this.marginToken)}))}onPayTokenSelect(t){return Object(r.a)(this,void 0,void 0,(function*(){this.payToken=t.symbol,localStorage.setItem("leveragePayToken",this.payToken)}))}toggleVisibility(t){this.marked=t.target.checked}}return t.\u0275fac=function(e){return new(e||t)(s.Ob(l.a),s.Ob(d.a),s.Ob(u.a))},t.\u0275cmp=s.Ib({type:t,selectors:[["app-step1"]],decls:52,vars:14,consts:[[1,"pt-2","pr-3","pl-3","pt-md-5","mt-1"],[1,"pr-3","pl-3"],[1,"container","mt-4","mt-md-4","p-0","p-md-3"],[1,"card","mr-auto","ml-auto","col-lg-8","p-0"],[1,"card-header","text-center"],[1,"card-body","p-0","pl-md-4","pr-md-4","pb-md-3","pt-3"],[4,"ngIf"],[1,"form-row","justify-content-between","field-labels","d-none","d-md-flex"],[1,"form-group","col-md-3","mb-1"],[1,"form-row","border-bottom","mb-3"],[1,"form-group","col-12","col-md-3"],["id","marginToken",3,"token","tokenBlackList","tokenSpender","onTokenSelect"],[1,"form-group","col-12","col-md-6","pt-3","pt-md-0"],["id","amount","name","amount",3,"token","tokenAmountBN","gasPrice","tokenAmountBNChange"],["id","fromToken",3,"token","tokenSpender","onTokenSelect"],[1,"pt-4","text-center"],["btnRadioGroup","",1,"btn-group",3,"ngModel","ngModelChange"],["btnRadio","short","tabindex","0","role","button",1,"btn","btn-info"],["btnRadio","long","tabindex","0","role","button",1,"btn","btn-info"],[1,"text-center","pt-3"],[1,"pt-3","text-center"],["btnRadio","2x","tabindex","0","role","button",1,"btn","btn-info","round"],["btnRadio","3x","tabindex","0","role","button",1,"btn","btn-info","round"],["btnRadio","4x","tabindex","0","role","button",1,"btn","btn-info","round"],["btnRadio","5x","tabindex","0","role","button",1,"btn","btn-info","round"],[1,"form-check","text-center","pt-3"],["type","checkbox","value","","id","botActivate","data-md-icheck","",1,"form-check-input",3,"ngModel","ngModelChange","change","click"],["for","botActivate",1,"form-check-label"],[1,"col-12","text-center","pt-4"],[1,"btn","btn-lg","btn-success"],["class","mb-3",4,"ngIf"],[1,"mb-3"],["class","mb-1","type","success",3,"close",4,"ngIf"],["class","mb-1","type","danger",3,"close",4,"ngIf"],["type","success",1,"mb-1",3,"close"],["target","_blank",3,"href"],["type","danger",1,"mb-1",3,"close"],[1,"row","pt-4","ml-md-4","mr-md-4"],[1,"col-4","col-xs-12","mt-2"],["tooltip","Lowest price which will trigger closing position",1,"upper",3,"icon"],[1,"col-8","col-xs-12"],[1,"input-group"],["type","text","placeholder","in %","aria-label","Amount",1,"form-control"],[1,"input-group-append"],["type","button",1,"btn","btn-outline-secondary"],["tooltip","Highest price which will trigger closing position",1,"upper",3,"icon"]],template:function(t,e){1&t&&(s.Tb(0,"h1",0),s.Ic(1," Leverage aggregator with automated trading strategy,"),s.Pb(2,"br"),s.Ic(3,"lowest price slippage and gas costs.\n"),s.Sb(),s.Tb(4,"h2",1),s.Ic(5," Achieving best results by using flash loans and liquidation save bot.\n"),s.Sb(),s.Tb(6,"div",2),s.Tb(7,"div",3),s.Tb(8,"div",4),s.Tb(9,"h5"),s.Ic(10,"Create position"),s.Sb(),s.Sb(),s.Tb(11,"div",5),s.Gc(12,_,1,0,"app-loading-spinner",6),s.Gc(13,U,2,1,"div",6),s.Tb(14,"div",7),s.Tb(15,"div",8),s.Ic(16," Leverage Token: "),s.Sb(),s.Tb(17,"div",8),s.Ic(18," Pay Token: "),s.Sb(),s.Sb(),s.Tb(19,"div",9),s.Tb(20,"div",10),s.Tb(21,"oi-token-selector",11),s.fc("onTokenSelect",(function(t){return e.onMarginTokenSelect(t)})),s.Sb(),s.Sb(),s.Tb(22,"div",12),s.Tb(23,"oi-token-amount-field",13),s.fc("tokenAmountBNChange",(function(t){return e.amountBN=t})),s.Sb(),s.Sb(),s.Tb(24,"div",10),s.Tb(25,"oi-token-selector",14),s.fc("onTokenSelect",(function(t){return e.onPayTokenSelect(t)})),s.Sb(),s.Sb(),s.Sb(),s.Tb(26,"div",15),s.Tb(27,"div",16),s.fc("ngModelChange",(function(t){return e.positionModel=t})),s.Tb(28,"label",17),s.Ic(29,"Short"),s.Sb(),s.Tb(30,"label",18),s.Ic(31,"Long"),s.Sb(),s.Sb(),s.Sb(),s.Tb(32,"h5",19),s.Ic(33,"Pick your leverage"),s.Sb(),s.Tb(34,"div",20),s.Tb(35,"div",16),s.fc("ngModelChange",(function(t){return e.leverageModel=t})),s.Tb(36,"label",21),s.Ic(37,"2X"),s.Sb(),s.Tb(38,"label",22),s.Ic(39,"3X"),s.Sb(),s.Tb(40,"label",23),s.Ic(41,"4X"),s.Sb(),s.Tb(42,"label",24),s.Ic(43,"5X"),s.Sb(),s.Sb(),s.Sb(),s.Tb(44,"div",25),s.Tb(45,"input",26),s.fc("ngModelChange",(function(t){return e.useT800SaveBot=t}))("change",(function(t){return e.toggleVisibility(t)}))("click",(function(t){return e.toggleVisibility(t)})),s.Sb(),s.Tb(46,"label",27),s.Ic(47," Use T-800 liquidation save bot "),s.Sb(),s.Sb(),s.Gc(48,F,21,2,"div",6),s.Tb(49,"div",28),s.Tb(50,"button",29),s.Ic(51,"Continue"),s.Sb(),s.Sb(),s.Sb(),s.Sb(),s.Sb()),2&t&&(s.Bb(12),s.nc("ngIf",e.loading),s.Bb(1),s.nc("ngIf",!e.loading),s.Bb(8),s.nc("token",e.marginToken)("tokenBlackList",e.tokenBlackList)("tokenSpender",e.tokenSpender),s.Bb(2),s.nc("token",e.payToken)("tokenAmountBN",e.amountBN)("gasPrice",e.gasPrice),s.Bb(2),s.nc("token",e.payToken)("tokenSpender",e.tokenSpender),s.Bb(2),s.nc("ngModel",e.positionModel),s.Bb(8),s.nc("ngModel",e.leverageModel),s.Bb(10),s.nc("ngModel",e.useT800SaveBot),s.Bb(3),s.nc("ngIf",e.useT800SaveBot))},directives:[o.l,C,A,x.c,c.j,c.k,x.b,c.a,E.a,T.a,R.a,x.f],styles:["h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%]{font-weight:300;text-align:center}h1[_ngcontent-%COMP%]{font-size:2rem}h2[_ngcontent-%COMP%]{font-size:1.1rem}@media(max-width:768px){h1[_ngcontent-%COMP%]{font-size:1.4rem;line-height:1.8rem}h2[_ngcontent-%COMP%]{font-size:.8rem}span.relays-hint[_ngcontent-%COMP%]{font-size:60%}}.active[_ngcontent-%COMP%]{background:#ea262a!important;border:1px solid #ea262a!important;box-shadow:none!important}.round[_ngcontent-%COMP%]{margin-left:.5em;margin-right:.5em;border-radius:100px!important}.upper[_ngcontent-%COMP%]{font-size:11px!important;padding:2px}"]}),t})()},{path:"positions",component:(()=>{class t{constructor(){this.positions=G}ngOnInit(){}operate(t){console.log(t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Ib({type:t,selectors:[["app-my-positions"]],decls:30,vars:1,consts:[[1,"pt-2","pr-3","pl-3","pt-md-5","mt-1"],[1,"pr-3","pl-3"],[1,"container","mt-4","mt-md-4","p-0","p-md-3"],[1,"card","mr-auto","ml-auto","col-lg-10","p-0"],[1,"card-header","text-center"],[1,"card-body","p-0","pl-md-4","pr-md-4","pb-md-3","pt-3"],[1,"table"],["scope","col"],[4,"ngFor","ngForOf"],[1,"btn","btn-success","btn-sm","mr-1",3,"click"],[1,"btn","btn-danger","btn-sm",3,"click"]],template:function(t,e){1&t&&(s.Tb(0,"h1",0),s.Ic(1," Manage and track your leverage positions.\n"),s.Sb(),s.Tb(2,"h2",1),s.Ic(3," Get more transparency by using chart view and manage your stop loss and take profit limits.\n"),s.Sb(),s.Tb(4,"div",2),s.Tb(5,"div",3),s.Tb(6,"div",4),s.Tb(7,"h5"),s.Ic(8,"My Positions"),s.Sb(),s.Sb(),s.Tb(9,"div",5),s.Tb(10,"table",6),s.Tb(11,"thead"),s.Tb(12,"tr"),s.Tb(13,"th",7),s.Ic(14,"Leverage Token"),s.Sb(),s.Tb(15,"th",7),s.Ic(16,"Position"),s.Sb(),s.Tb(17,"th",7),s.Ic(18,"Leverage"),s.Sb(),s.Tb(19,"th",7),s.Ic(20,"Profit"),s.Sb(),s.Tb(21,"th",7),s.Ic(22,"Status"),s.Sb(),s.Tb(23,"th",7),s.Ic(24,"Stop Loss"),s.Sb(),s.Tb(25,"th",7),s.Ic(26,"Take Profit"),s.Sb(),s.Pb(27,"th",7),s.Sb(),s.Sb(),s.Tb(28,"tbody"),s.Gc(29,H,20,7,"tr",8),s.Sb(),s.Sb(),s.Sb(),s.Sb(),s.Sb()),2&t&&(s.Bb(29),s.nc("ngForOf",e.positions))},directives:[o.k],styles:["h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%]{font-weight:300;text-align:center}h1[_ngcontent-%COMP%]{font-size:2rem}h2[_ngcontent-%COMP%]{font-size:1.1rem}@media(max-width:768px){h1[_ngcontent-%COMP%]{font-size:1.4rem;line-height:1.8rem}h2[_ngcontent-%COMP%]{font-size:.8rem}span.relays-hint[_ngcontent-%COMP%]{font-size:60%}}"]}),t})()}]}];let K=(()=>{class t{}return t.\u0275mod=s.Mb({type:t}),t.\u0275inj=s.Lb({factory:function(e){return new(e||t)},imports:[[i.e.forChild(J)],i.e]}),t})(),z=(()=>{class t{}return t.\u0275mod=s.Mb({type:t}),t.\u0275inj=s.Lb({factory:function(e){return new(e||t)},imports:[[o.c,T.e,c.n]]}),t})();var $=n("Qe2p");n.d(e,"LeverageModule",(function(){return X}));let X=(()=>{class t{}return t.\u0275mod=s.Mb({type:t}),t.\u0275inj=s.Lb({factory:function(e){return new(e||t)},imports:[[o.c,K,c.f,x.d,R.b,x.g.forRoot(),z,c.n,$.a,T.b]]}),t})()}}]);